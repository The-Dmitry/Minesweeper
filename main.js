(()=>{"use strict";var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{var t;e.g.importScripts&&(t=e.g.location+"");var s=e.g.document;if(!t&&s&&(s.currentScript&&(t=s.currentScript.src),!t)){var o=s.getElementsByTagName("script");o.length&&(t=o[o.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=t})();class t{#e;constructor({tagName:e="div",classNames:t=[],textContent:s="",attribute:o,parentNode:n}){this.#e=document.createElement(e),this.#e.classList.add(...t),this.#e.textContent=s,n&&n.append(this.#e),o&&this.#e.setAttribute(...o)}append(e){this.#e.append(e.getNode())}getNode(){return this.#e}appendChildren(e){e.forEach((e=>{this.append(e)}))}removeAllChildren(){for(;this.#e.lastChild;)this.#e.lastChild.remove()}}class s extends t{isFlag=!1;constructor({tagName:e,classNames:t,textContent:s,attribute:o,parentNode:n},a,i=!1){super({tagName:e,classNames:t,textContent:s,attribute:o,parentNode:n}),this.id=a,this.bomb=i}setTheBomb(){this.bomb=!0}isBomb(){return this.bomb}setTheFlag(){this.isFlag=!this.isFlag,this.getNode().classList.toggle("flag")}boom(e){this.getNode().classList.remove("flag"),this.getNode().classList.add(`${e}`),"boom"===e&&(this.getNode().disabled=!0)}notBoom(e){const t=this.getNode();t.textContent=`${e}`,t.disabled=!0,t.classList.add(`near-${e}`)}}class o extends t{constructor({tagName:e,classNames:t,textContent:s,attribute:o,parentNode:n,options:a,type:i}){super({tagName:e,classNames:t,textContent:s,attribute:o,parentNode:n}),a&&(this.options=a),i&&this.getNode().setAttribute("type",i)}setOptions(){this.options.forEach((e=>{const t=new Option(`${e.title}`,`${e.columns}`);this.getNode().add(t)}))}setMinMax(e,t){const s=this.getNode();s.placeholder=`Max mines: ${t}`,s.min=e,s.max=t}clearValue(){this.getNode().value=""}getModeObject(e){return this.options.find((t=>t.columns===e))}selectOption(e){let t;this.getNode().childNodes.forEach((s=>{+s.value===e&&(t=s)})),t.selected=!0}setChecked(){this.getNode().checked=!0}}const n={win:e.p+"src/sounds/win.wav",defeat:e.p+"src/sounds/defeat.wav",move:e.p+"src/sounds/move.wav"};let a=[],i=[],l=[],r=JSON.parse(localStorage.getItem("theme"));const{body:d}=document,c=new Audio;c.volume=.5;const g=new class extends t{#t=[];#s=0;openedCells=0;#o=[];#n=0;#a=0;#i=!1;#l=!1;constructor({tagName:e,classNames:t,textContent:s,attribute:o,parentNode:n},a,i,l){super({tagName:e,classNames:t,textContent:s,attribute:o,parentNode:n}),this.#s=a,this.#a=i,this.#n=l}generatePlayground(){const e=this.#a,t=[];let o=0;for(let n=0;n<this.#s/e;n+=1){const a=[];for(let t=0;t<e;t+=1){const e=new s({tagName:"button",classNames:["cell"],attribute:["x-y",[n,t]]},o);a.push(e),o+=1}t.push(a),this.appendChildren(a)}this.setCellsList=t}defineBombs(e,t){const s=new Array(this.#s).fill(0).map(((e,t)=>t));for(let e=s.length-1;e>0;e-=1){const t=Math.floor(Math.random()*(e+1)),o=s[e];s[e]=s[t],s[t]=o}const o=new Set(s.slice(0,this.#n)),n=this.getCellsList[e][t].id;if(o.has(n)){const e=o.size;for(o.delete(n);o.size<e;){const e=Math.floor(Math.random()*(this.#n+1));e!==n&&o.add(e)}}this.#o=o,this.plantBombs()}plantBombs(){const e=this.getCellsList;for(let t=0;t<e.length;t+=1)e[t].forEach((e=>{this.#o.has(e.id)&&e.setTheBomb()}))}checkTheCell(e,t){if(this.#i||(this.#i=!0,this.defineBombs(+e,+t)),!this.isValid(e,t))return;const s=this.getCellsList[e][t];if(s.getNode().disabled||s.isFlag)return;if(s.isBomb())return s.boom(),void(this.#l=!0);s.getNode().disabled=!0,this.openedCells+=1;const o=this.checkAround(e,t);if(o>0)s.notBoom(o);else for(let s=-1;s<=1;s+=1)for(let o=-1;o<=1;o+=1)this.isValid(e+s,t+o)&&this.checkTheCell(e+s,t+o)}checkAround(e,t){let s=0;for(let o=-1;o<=1;o+=1)for(let n=-1;n<=1;n+=1)this.isValid(e+o,t+n)&&this.getCellsList[e+o][t+n].isBomb()&&(s+=1);return s}isValid(e,t){const s=this.getCellsList.length-1,o=this.getCellsList[0].length-1;return e>=0&&e<=s&&t>=0&&t<=o}isWon(){return this.#s-this.openedCells===this.#n}startNewGame(e,t,s){this.removeAllChildren(),this.#i=!1,this.#l=!1,e&&t&&(this.#s=e,this.#n=t,this.#a=s,this.getNode().classList.remove("size-10","size-15","size-25"),this.getNode().classList.add(`size-${s}`)),this.openedCells=0,this.generatePlayground(),this.getNode().classList.remove("no-events")}loadGame({cellsCount:e,bombsList:t,columns:s,stepsArray:o,flagArray:n}){this.#s=e,this.#o=new Set(t),this.#a=s,this.#i=!0,this.generatePlayground(),this.plantBombs(),this.loadFlags(n),this.getNode().classList.remove("size-10","size-15","size-25"),this.getNode().classList.add(`size-${s}`),o.forEach((e=>{this.checkTheCell(...e)}))}loadFlags(e){e.forEach((e=>{this.setTheFlag(...e)}))}blowUpEverything(e){this.getCellsList.forEach((t=>t.forEach((t=>{t.bomb&&t.boom(e)}))))}get isLoose(){return this.#l}setTheFlag(e,t){this.getCellsList[e][t].setTheFlag()}get isGameStarted(){return this.#i}set isGameStarted(e){this.#i=e}set setCellsList(e){this.#t=e}get getCellsList(){return this.#t}get getBombsList(){return this.#o}set setBombsList(e){this.#o=e}set cellsCount(e){this.#s=e,this.generatePlayground()}get cellsCount(){return this.#s}get getColumns(){return this.#a}}({classNames:["playground","size-10"],parentNode:d},100,10,10),m=new t({classNames:["control"],parentNode:d}),h=new class extends t{#r=0;#d=!1;startOrEnd(e){e!==this.#d&&(this.#d=e,this.countdown())}countdown(){this.#d?setTimeout((()=>{this.#r+=1,this.calcDuration(this.#r),this.countdown()}),1e3):this.calcDuration(this.#r)}calcDuration(e){const t=parseInt(e%60,10),s=Math.floor(e/60);this.getNode().textContent=`${s.toString().padStart(2,0)}:${t.toString().padStart(2,0)}`||"00:00"}set isGamePlaying(e){this.#d=e}set seconds(e){this.#r=e}get seconds(){return this.#r+1}}({classNames:["timer"],textContent:"00:00"}),u=new t({tagName:"button",classNames:["new-game"],textContent:"New Game"}),p=new class extends t{#c=0;updateStep(){this.#c+=1,this.getNode().textContent=`Moves: ${this.#c}`}set steps(e){this.#c=e,this.updateStep()}get steps(){return this.#c}}({classNames:["steps"],textContent:"Moves: 0"}),N=new t({tagName:"button",textContent:"Results",classNames:["results"]}),b=new t({classNames:["modal-parent","hidden"],parentNode:d}),f=new t({classNames:["cross"]}),C=new t({tagName:"h2",classNames:["result-title"],textContent:"Results"}),L=new t({classNames:["result-list"]}),v=new o({tagName:"select",classNames:["select-mode"],options:[{title:"10x10",totalCells:100,columns:10},{title:"15x15",totalCells:225,columns:15},{title:"25x25",totalCells:625,columns:25}]}),w=new o({tagName:"input",classNames:["mines-count"],type:"number"}),S=new class extends t{#g;set setFlags(e){this.#g=e}get getFlags(){return this.#g}updateFlags(){this.getNode().textContent=`Flags/Mines: ${this.#g}`}changeCountFlag(e){this.#g+=e,this.updateFlags()}}({classNames:["flag-count"],textContent:"Flags/Mines: 0"}),y=new t({tagName:"button",classNames:["theme"]}),x=new t({tagName:"button",classNames:["sound-switch"],parentNode:d}),F=new t({classNames:["final-message"]});function E(e){c.src=e,c.play()}function G(){if(r)return d.classList.add("dark"),void y.getNode().classList.remove("sun");d.classList.remove("dark"),y.getNode().classList.add("sun")}function T(){h.isGamePlaying=!1,g.getNode().classList.add("no-events"),g.isGameStarted=!1}function $(){F.getNode().remove(),b.getNode().classList.toggle("hidden"),g.getNode().classList.toggle("no-events-modal"),u.getNode().classList.toggle("no-events-modal")}function M(){L.removeAllChildren();let e="";l.length?l.reverse().forEach(((t,s)=>{const o=parseInt(t.time%60,10).toString().padStart(2,0),n=`<p class="result">${s+1}. Time: ${Math.floor(t.time/60).toString().padStart(2,0)}:${o}, Steps: ${t.steps}, Mode: ${t.mode}x${t.mode}, Mines: ${t.mines}</p>`;e+=n})):e='<p class="result">The list of games is empty. Only won games are counted</p>',L.getNode().innerHTML=e}function A(e,t,s){if(e){const e=parseInt(t%60,10).toString().padStart(2,0),o=Math.floor(t/60).toString().padStart(2,0);F.getNode().innerHTML=`<p class="message">Hooray! You found all mines in ${o}:${e} and ${s} moves!</p>\n                          <button class="close-message">Close</button>`}else F.getNode().innerHTML='<p class="message">Game over. Try again</p>\n                          <button class="close-message">Close</button>';F.getNode().addEventListener("click",(()=>{F.getNode().remove()})),setTimeout((()=>{d.append(F.getNode())}),700)}function B(e){if(e){const t={time:h.seconds,steps:p.steps,mode:g.getColumns,mines:g.getBombsList.size};return l.push(t),l=l.slice(-10),localStorage.setItem("results",JSON.stringify(l)),M(),A(e,t.time,t.steps),void setTimeout((()=>{E(n.win)}),700)}A(e),setTimeout((()=>{E(n.defeat)}),700)}m.appendChildren([h,u,p,v,w,N,S,y]),b.appendChildren([f,C,L]),v.setOptions(),w.setMinMax(10,99),N.getNode().onclick=$,f.getNode().onclick=$,u.getNode().addEventListener("mousedown",(function(){F.getNode().remove();const{totalCells:e,columns:t}=v.getModeObject(+v.getNode().value),s=+w.getNode().value,o=s>9?s:10;w.getNode().value=o,g.startNewGame(e,o,t),h.isGamePlaying=!1,h.seconds=-1,h.getNode().textContent="00:00",S.setFlags=o,S.updateFlags(),p.steps=-1,a=[],i=[]})),g.getNode().addEventListener("mousedown",(function(e){const{target:t}=e;if(!t.matches(".cell"))return;const[s,o]=t.getAttribute("x-y").split(",");if(2!==e.button)g.checkTheCell(+s,+o),E(n.move),t.matches(".flag")||(p.updateStep(),a.push([+s,+o])),h.startOrEnd(g.isGameStarted),g.isWon()&&(g.blowUpEverything("not-boom"),T(),B(!0)),g.isLoose&&(T(),B(!1),g.blowUpEverything("boom"));else{if(t.matches(".flag")){S.changeCountFlag(1);const e=function(e,t){let s=-1;const o=JSON.stringify(t);return e.forEach(((e,t)=>{o===JSON.stringify(e)&&(s=t)})),s}(i,[+s,+o]);return e>=0&&i.splice(e,1),void g.setTheFlag(+s,+o)}S.getFlags&&(S.changeCountFlag(-1),g.setTheFlag(+s,+o),i.push([+s,+o]))}})),v.getNode().addEventListener("change",(()=>{w.clearValue()})),w.getNode().addEventListener("input",(e=>{const t=e.target;+t.value>t.max&&(t.value=t.max)})),g.getNode().addEventListener("contextmenu",(e=>{e.preventDefault()})),y.getNode().addEventListener("mousedown",(()=>{r=!r,G(),localStorage.setItem("theme",r)})),x.getNode().addEventListener("mousedown",(()=>{x.getNode().classList.toggle("sound-switch_off"),c.volume?c.volume=0:c.volume=.5})),window.addEventListener("beforeunload",(()=>{!function(){if(g.isGameStarted){const e={cellsCount:g.cellsCount,bombsList:[...g.getBombsList],timer:h.seconds,steps:p.steps,stepsArray:a,flagArray:i,columns:g.getColumns},t=JSON.stringify(e);localStorage.setItem("game",t)}else localStorage.removeItem("game")}()})),function(){const e=localStorage.getItem("game"),t=localStorage.getItem("results");if(t&&(l=JSON.parse(t)),G(),M(),e){const t=JSON.parse(e);return g.loadGame(t),h.seconds=t.timer-1,h.calcDuration(t.timer-1),a=t.stepsArray,i=t.flagArray,p.steps=t.steps-1,w.getNode().value=t.bombsList.length,S.setFlags=t.bombsList.length,S.changeCountFlag(-i.length),void v.selectOption(t.columns)}g.generatePlayground(),S.setFlags=10,S.updateFlags()}()})();